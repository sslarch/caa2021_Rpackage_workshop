---
title: "Exercise package building"
author: "Sophie C. Schmidt"
date: "7 6 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE,
                      echo = TRUE)
```

# Create your package!

```{r}
usethis::create_package("/path/to/myAMAZINGpackage")
```

R will tell you, what it does, it should look something like this: 

```r
✓ Creating '/path/to/myAMAZINGpackage/'
✓ Setting active project to '/path/to/myAMAZINGpackage'
✓ Creating 'R/'
✓ Writing 'DESCRIPTION'
... tells you what it writes in there
✓ Writing 'NAMESPACE'
✓ Writing 'myAMAZINGpackage.Rproj'
✓ Adding '^myAMAZINGpackage\\.Rproj$' to '.Rbuildignore'
✓ Adding '.Rproj.user' to '.gitignore'
✓ Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
✓ Opening '/path/to/myAMAZINGpackage' in new RStudio session
✓ Setting active project to '<no active project>'
```

So you now have a new Rstudio project and the bare bones of a package.

In Rstudio Cloud now make sure your build tools are up for package building:

- upper horizontal menu -> Build -> Configure Build Tools -> in drop down menu "project build tools" choose *package*
- a new tab on the upper right hand corner (next to environment) should appear

## edit the DESCRIPTION file
Go in your new package to the DESCRIPTION file, open it and change the title, description and authors - with dummy data, if you want. For Title: remember capital letters all around (and no more than 65 character), in the description remember: no more than 80 characters and indent the 2.,3. & 4.th line with 4 empty spaces.

## add a function to the R/ folder

Now we will add a small function to the R-folder.

Create a script, call it "doublemean.R". In it write:

```{r}
doublemean <- function(x) {
  y <- mean(x)*2
  return(y)
}
```

and save it.

## try it!

Let's try the function we just defined!

```{r}
doublemean(c(2,3,4))
```

Uh. Couldn't find function.

Yes, because we didn't load our new package yet. We didn't actually run the code. 

## load your function!

Now, make sure your workspace is set to your package, load `devtools` and try `load_all()`. There should be a small message saying "Loading yourpackagename".

Let's now try the doublemean function!

```{r}
doublemean(c(2,3,4))
```

Did it work? Yay!


## adding dependencies

Now, let's go back to our doublemean function and add a twist. For absolutely logical reasons we want to know the doublemean only, if our vector x doesn't come from the same distribution as c(1,2,3)... else, we just want to be told it's significant.

```{r}
doublemean <- function(x) {
#Does x come from the same distribution as 1,2,3?
  n <- c(1,2,3)
  z <- ks.test(x, n)
  if (z$p.value > 0.05) {
    y <- mean(x)*2
    return(y)
  }
  else
  {print("It's significant")}

}

```

Copy the code, save the doublemean.R - file, do a `load_all()` and try the function.

Why doesn't it work?

Because we forgot to add the dependency.

ks.test comes from the package stats.

We therefore need to do two changes:

a) Add `stats::` in front of the function call inside our function code and
b) Add `stats` to the `Imports` in the DESCRIPTION


Now, after these changes, what will you do?

Yeah.

`load_all()` and try again...

Does it run?

Super!

## check it!
run 
```{r}
devtools::check()
```
Are there any errors, warnings or messages plopping up?
Do they help you?

I can see one warning about the license I specified (I didn't change anything). Don't worry about it for now. a) we will talk about licensing later and b) it's not an error.

## export the function

Now, we are at the moment working "inside" our package. To make the function available "outside" our package, we define it in the NAMESPACE.
Go open NAMESPACE, ignore the line *# Generated by roxygen2: do not edit by hand* for now and type underneath:

```{r}
export(doublemean)
```

We will later learn how to do this automatically. For now, let's continue:

## build it!
Let's now build our package! 

```{r}
devtools::build()
```

This should return something like

```r
✓  checking for file ‘/path/myexample/DESCRIPTION’ ...
─  preparing ‘myexample’:
✓  checking DESCRIPTION meta-information ... 
─  checking for LF line-endings in source and make files and shell scripts
─  checking for empty or unneeded directories
   Removed empty directory ‘myexample/man’
─  building ‘myexample_0.0.0.9000.tar.gz’
   
[1] "/path/myexample_0.0.0.9000.tar.gz"
```

Yay! We've got a tar.gz! Now, let's install it. 

Make sure you're not in the package - project or workspace anymore. Now let's install our package from source:
```{r}
install.packages("/samepath/myexample_0.0.0.9000.tar.gz", repos = NULL, type="source")
```

And let's have a look whether our amazing doublemean-function runs!
```{r}
myexample::doublemean(c(3,4,5))
```

Yay!


# Now you!

Please add another function to your package, in which you check whether a vector is normally distributed and if yes, print the mean, if not, give the message "It's not normal, use median!". Use the `jarque.bera.test()` from the `tseries` - package. If p larger than 0.05 x should be normally distributed.



